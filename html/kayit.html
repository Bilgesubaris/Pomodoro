<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kayıt Ol | Pomodoro</title>
  <link rel="stylesheet" href="../css/giris.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <div class="row justify-content-center align-items-center min-vh-100">
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-lg border-0 rounded-4">
          <div class="card-body p-5">
            <h2 class="text-center mb-4 fw-bold text-success">Kayıt Ol</h2>
            
            <form id="registerForm">
              <div class="mb-3">
                <label for="name" class="form-label">Ad Soyad</label>
                <input type="text" class="form-control" id="name" required>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">E-posta</label>
                <input type="email" class="form-control" id="email" required>
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Şifre</label>
                <input type="password" class="form-control" id="password" required minlength="6">
                <div class="form-text">En az 6 karakter olmalıdır.</div>
              </div>
              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Şifre Tekrar</label>
                <input type="password" class="form-control" id="confirmPassword" required>
              </div>
              <button type="submit" class="btn btn-success w-100 mb-3">Kayıt Ol</button>
            </form>
            
            <div class="text-center mt-4">
              <p class="mb-0">Zaten hesabın var mı? <a href="giris.html" class="text-primary fw-bold">Giriş Yap</a></p>
            </div>
            
            <div id="message" class="alert mt-3" style="display: none;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCoIcZ0noCXfPSkyZsacZajiH5fjbh32mk",
      authDomain: "pomodoro-7bde7.firebaseapp.com",
      projectId: "pomodoro-7bde7",
      storageBucket: "pomodoro-7bde7.firebasestorage.app",
      messagingSenderId: "428259058667",
      appId: "1:428259058667:web:9cdb91f7d1d4d88f34efae",
      measurementId: "G-9PZZ9256PW"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM elements
    const registerForm = document.getElementById('registerForm');
    const messageDiv = document.getElementById('message');

    function showMessage(message, type = 'info') {
      messageDiv.textContent = message;
      messageDiv.className = `alert alert-${type} mt-3`;
      messageDiv.style.display = 'block';
    }

    // Kayıt ol
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      // Şifre kontrolü
      if (password !== confirmPassword) {
        showMessage('Şifreler eşleşmiyor!', 'danger');
        return;
      }

      if (password.length < 6) {
        showMessage('Şifre en az 6 karakter olmalıdır!', 'danger');
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        // Kullanıcı bilgilerini Firestore'a kaydet
        await setDoc(doc(db, "users", user.uid), {
          name: name,
          email: email,
          pomodoroSettings: {
            pomodoro: 25,
            shortBreak: 5,
            longBreak: 15
          },
          createdAt: new Date()
        });

        showMessage('Hesap başarıyla oluşturuldu!', 'success');
        setTimeout(() => {
          window.location.href = 'panel.html';
        }, 1500);
      } catch (error) {
        showMessage('Kayıt hatası: ' + error.message, 'danger');
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
